#!/bin/bash
# Génération automatique de la documentation
# Lie les pages de doc généré par jsdoc depuis les commentaires des méthodes du code
# Nécéssite jsdoc ( http://usejsdoc.org/ )

dest=doc #Dossier de destination de la doc
src=js #Dossier contenant les sources

fichiers_importes=(js/phaser.min.js js/hammer.min.js js/js-yaml.js js/phaser-arcade-physics.min.js js/phaser.js)


containsElement () {
  local e
  for e in ${fichiers_importes[*]}; do [[ "$e" == "$1" ]] && return 0; done
  return 1
}

rm -rf $dest
mkdir $dest

echo '<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

    <h1 class="page-title" >JSDoc</h1>
    <p> Voici la documentation des sources JavaScript du jeu.</p>
    <ul>' >> $dest/final_index.html
	

for i in js/*.js
do
    if containsElement $i "${array[@]}"; then continue; fi
    
    jsdoc $i -d $dest
    echo $dest/index_"${i##*/}".html généré.
    mv $dest/global.html  $dest/index_"${i##*/}".html
    
    echo '        <li>
        <a href="index_'${i##*/}'.html">'${i##*/}'</a>
    </li>' >> $dest/final_index.html
    
    sed 's:<h1 class="page-title">Global</h1>:<h1 class="page-title">'$i'</h1>:' <$dest/index_"${i##*/}".html >temp
    mv temp $dest/index_"${i##*/}".html
    sed 's:<h3>Global</h3>:<h3>'$i'</h3>:' <$dest/index_"${i##*/}".html >temp
    mv temp $dest/index_"${i##*/}".html

done

echo '    </ul>

<br clear="both">
<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha8</a> on Wed Jun 18 2014 12:05:30 GMT+0200 (CEST)
</footer>
<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
' >> $dest/final_index.html
mv $dest/final_index.html $dest/index.html

echo 'Doc disponible dans '$dest'/index.html'
