\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{hyperref}
\setlength{\topmargin}{-.5in}
\setlength{\textheight}{9in}
\setlength{\oddsidemargin}{.125in}
\setlength{\textwidth}{6.25in}
\begin{document}
\title{Documentation Développeur}
\author{Thomas Bombrun, Dimitri Bouleau, Thomas Coeffic, Caroline Ramond, Théo Van-Lede\\
INPG - Ensimag}
\renewcommand{\today}{17 Juin 2014}
\maketitle
Ce document est un complément de la documentation générée automatiquement, 
qui justifie l'implémentation et présente la structure des dossiers. Il explique également comment générer les applications $iOS$ et $Android$ correspondantes, et comment installer l'éditeur de niveaux.

\section {Javascript}
Ces fichiers sont stockés dans le dossier {\em js}.
\begin{itemize}
	\item
		\textbf{constants.js} : Permet de charger le fichier de 
		configuration yaml.\\
	\item
		\textbf{cookie.js} : Assure la gestion des cookies (dans le
		cas d'une utilisation web) ou de la mémoire locale (dans 
		le cas d'une utilisation mobile), afin de conserver l'état 
		d'avancement de l'utilisateur dans les niveaux.\\
	\item
		\textbf{create.js} : Permet de créer les différents écrans du
		jeu : le menu principal, le menu de sélection de niveau, et 
		l'écran correspondant à un début de partie.\\
	\item
		\textbf{createLevel.js} : Met à jour l'index des niveaux, 
		fonctionne pour le tutoriel et le jeu classique.\\
	\item
		\textbf{eventFunction.js} : Gère la majorité des événements 
		associés aux clics dans les menus et en jeu, ainsi que les 
		actions déclenchées durant une partie (affichage de l'écran de 
		fin, rencontre avec un bloc).\\
	\item
		\textbf{help.js} : Gère les écrans d'aide.\\
	\item
		\textbf{main.js} : Charge les différentes ressources 
		nécessaires, contient la définition des variables globales 
		utilisées dans plusieurs fichiers.\\
	\item
		\textbf{moveball.js} : Gère les déplacements de la bille 
		(prise en compte des actions de l'utilisateur, appel des 
		fonctions adéquates dans {\em eventFunction} en cas de 
		collision/chevauchement).\\
		Gère aussi les déplacements et repositionnements nécessaires 
		pour les blocs {\em turn}.\\
	\item
		\textbf{parser.js} : Permet la lecture et le chargement en 
		mémoire d'un fichier de niveau.\\
	\item
		\textbf{sound.js} : Gère les animations sonores du jeu.\\
	\item
		\textbf{hammer.min.js} : Gère les événements sur mobile. Licence
		MIT.\\
		\href{https://github.com/EightMedia/hammer.js}
		{hammer sur Github}\\
	\item
		\textbf{js-yaml.js} : Parser de fichier yaml. Licence MIT\\
		\href{https://github.com/nodeca/js-yaml}{js-yaml sur GitHub}\\
	\item
		\textbf{phaser-arcade-physics.min.js} : Framework permettant
		la création simple de jeu. Cette version ne contient que la 
		physique Arcade. Licence MIT.\\
		\href{https://github.com/photonstorm/phaser}
		{phaser sur GitHub}\\
\end{itemize}
\section {Ressources}
Le dossier {\em ressources} contient les fichiers png chargés par le jeu.
Ils sont définis dans {\em conf.yaml}.\\
Le dossier {\em ressource-dev} contient les fichiers gimp correspondant à
ces fichiers png, et peuvent être utilisés pour modifier plus rapidement 
les ressources.\\
Les sons associés aux actions sont stockés dans {\em ressources/sounds}. Afin 
d'assurer une compatibilité avec firefox, il est préférable de ne pas utiliser de fichier mp3 (ogg
semble une bonne alternative).\\
Les niveaux sont eux dans le dossier {\em levels}, ils doivent être de la forme 
{\em 1.txt, 2.txt},... et se suivre. Il est en de même pour les niveaux du 
tutoriel qui sont dans le dossier {\em tutorial}.\\

\section {Justification de l'implémentation}
\begin{itemize}
	\item
		\textbf{Cookie.js} :\\
		On utilise {\em constants.USE\_CORDOVA} pour savoir si on 
		utilise :\\
		- les cookies : stars et levelMax, \\
		- la clé stars pour stocker ces données.\\
		Cela permet d'avoir un code unique pour la plateforme mobile et
		web.\\
	\item
		\textbf{eventFunction.js} :\\
		Dans toutes les fonctions appelées par overlap (défini dans 
		phaser.physics.arcade), on renforce la condition en forçant les
		deux sprites à être au moins à moitié chevauchantes pour
		effectuer l'action. Cela permet d'éviter les bugs liés à la
		bille déclenchant deux overlaps simultanés.\\
	\item
		\textbf{main.js} : \\
		On utilise une fonction pour trouver la valeur correspondant à
		un retour 'OK' après une requête de type 
		{\em XMLHTTPRequest.open}. Cela permet d'avoir un code
		fonctionnant pour Android (OK = 200, erreur = 0), iOS (OK = 0,
		erreur = 404) et Desktop (OK = 200, erreur = 404)
		sans utiliser user-agent qui est peu fiable. Cependant, cette
		approche nécessite de rattraper l'erreur dans le cas où le 
		niveau test n'est pas accessible (et donc renvoie une mauvaise 
		valeur pour OK). Pour cela il faut définir une limite maximale
		pour le nombre de niveaux.\\
	\item
		\textbf{moveball.js} : \\
		Ce fichier contient toute la gestion des déplacement de la
		bille, la gestion du score et la gestion des blocs {\em turn}.\\
		Les blocs {\em turn} sont très sensibles aux lags, il faut
		donc gérer les erreurs liées à un manque d'information (peu de 
		frames disponibles).\\
		Pour le score, il y a simplement {\em checkMoveGroup} qui
		vérifie la validité du déplacement demandé.\\
\end{itemize}

\section{Compilation des applications mobile}

Afin de générer les applications mobile correspondantes, il vous faut installer $Cordova$. Il faudra penser à recompiler l'application à chaque modification des ressources. Notre code supporte les plates-formes $iOS$ et $Android$. L'installation de $Cordova$ et la compilation des applications en ligne de commande sont détaillées sur le site de \href{http://cordova.apache.org/docs/en/3.5.0/guide_cli_index.md.html#The%20Command-Line%20Interface}{$Cordova$}.
	Il faut cloner le \href{https://github.com/ProjetCristallo/alchemist}{dépôt git} dans $www$ à la racine du projet $Cordova$. 

\section{Installation de l'éditeur}
\subsection{Sous Windows}
Récupérez l'archive sur le \href{https://github.com/ProjetCristallo/Editor/releases}{dépôt Editor sur github}, extrayez-la, puis lancez l'application Editor.
\subsection{Sous Linux}
Assurez-vous que vous avez installé qt4 ou qt5, extrayez l'archive correspondant à votre version sur github puis lancez l'application Editor.
\subsection{Sous Mac}
\begin{itemize}
\item Assurez-vous que vous avez installé qt4 ("$brew\ install\ qt4$").
\item Récupérez le dossier Editor sur github.
\item Placez-vous dans le dossier Editor, et exécutez les commandes "$qmake\ Editor.pro$", puis "$make$".
\item Copiez le fichier $editor.ini$ dans $/bin$.
\item Lancez l'application à l'aide de la commande "$./bin/Editor.app/Contents/MacOS/Editor$".
\end{itemize}


\end{document}
